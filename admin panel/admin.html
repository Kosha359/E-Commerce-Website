<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        h1, h2 {
            margin-bottom: 20px;
        }
        .table {
            margin-top: 20px;
        }
        .btn {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mt-4">Admin Panel</h1>
        
        <h2 class="mt-4">Manage Products</h2>
        <form id="productForm">
            <input type="hidden" id="productId">
            <div class="form-group">
                <input type="text" id="productName" class="form-control" placeholder="Product Name" required>
            </div>
            <div class="form-group">
                <textarea id="productDescription" class="form-control" placeholder="Product Description" required></textarea>
            </div>
            <div class="form-group">
                <input type="number" id="productPrice" class="form-control" placeholder="Price" required>
            </div>
            <div class="form-group">
                <input type="number" id="productStock" class="form-control" placeholder="Stock" required>
            </div>
            <button type="submit" class="btn btn-primary">Add Product</button>
            <button type="button" id="updateProductBtn" class="btn btn-warning" style="display:none;">Update Product</button>
        </form>

        <input type="text" id="productSearch" class="form-control" placeholder="Search Products" oninput="loadProducts()">
        <h2 class="mt-4">Product List</h2>
        <table class="table table-striped" id="productList">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Price</th>
                    <th>Stock</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="productTableBody"></tbody>
        </table>

        <h2 class="mt-4">Manage Users</h2>
        <form id="userForm">
            <input type="hidden" id="userId">
            <div class="form-group">
                <input type="text" id="userFirstName" class="form-control" placeholder="First Name" required>
            </div>
            <div class="form-group">
                <input type="text" id="userLastName" class="form-control" placeholder="Last Name" required>
            </div>
            <div class="form-group">
                <input type="email" id="userEmail" class="form-control" placeholder="Email" required>
            </div>
            <div class="form-group">
                <input type="text" id="userContact" class="form-control" placeholder="Contact Number" required>
            </div>
            <div class="form-group">
                <textarea id="userAddress" class="form-control" placeholder="Address" required></textarea>
            </div>
            <div class="form-group">
                <label for="isAdmin">Is Admin:</label>
                <select id="isAdmin" class="form-control">
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Add User</button>
            <button type="button" id="updateUserBtn" class="btn btn-warning" style="display:none;">Update User</button>
        </form>

        <h2 class="mt-4">User List</h2>
        <table class="table table-striped" id="userList">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Contact</th>
                    <th>Address</th>
                    <th>Admin</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="userTableBody"></tbody>
        </table>

        <h2 class="mt-4">Order History</h2>
        <input type="date" id="startDate" class="form-control" placeholder="Start Date" onchange="loadOrderHistory()">
        <input type="date" id="endDate" class="form-control" placeholder="End Date" onchange="loadOrderHistory()">
        <table class="table table-striped" id="orderHistoryTable">
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Customer Name</th>
                    <th>Quantity</th>
                    <th>Total Price</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="orderHistory"></tbody>
        </table>
    </div>

    <script>
        // Load Products with Search
        function loadProducts() {
            const search = document.getElementById('productSearch').value;
            fetch(`http://localhost:3000/products?search=${search}`)
                .then(response => response.json())
                .then(data => {
                    const productTableBody = document.getElementById('productTableBody');
                    productTableBody.innerHTML = '';
                    data.forEach(product => {
                        const row = `<tr>
                            <td>${product.id}</td>
                            <td>${product.name}</td>
                            <td>${product.description}</td>
                            <td>${product.price}</td>
                            <td>${product.stock}</td>
                            <td>
                                <button onclick="editProduct(${product.id}, '${product.name}', '${product.description}', ${product.price}, ${product.stock})" class="btn btn-warning">Edit</button>
                                <button onclick="deleteProduct(${product.id})" class="btn btn-danger">Delete</button>
                            </td>
                        </tr>`;
                        productTableBody.innerHTML += row;
                    });
                })
                .catch((error) => {
                    console.error('Error fetching products:', error);
                });
        }

        // Add or Update Product
        document.getElementById('productForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const id = document.getElementById('productId').value;
            const name = document.getElementById('productName').value;
            const description = document.getElementById('productDescription').value;
            const price = document.getElementById('productPrice').value;
            const stock = document.getElementById('productStock').value;

            if (id) {
                fetch(`http://localhost:3000/updateProduct/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description, price, stock })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    resetProductForm();
                    loadProducts();
                })
                .catch((error) => {
                    console.error('Error updating product:', error);
                });
            } else {
                fetch('http://localhost:3000/addProduct', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description, price, stock })
                })
                .then(response => response.json())
                .then(data => {
                    alert('Product added successfully!');
                    resetProductForm();
                    loadProducts();
                })
                .catch((error) => {
                    console.error('Error adding product:', error);
                });
            }
        });

        function editProduct(id, name, description, price, stock) {
            document.getElementById('productId').value = id;
            document.getElementById('productName').value = name;
            document.getElementById('productDescription').value = description;
            document.getElementById('productPrice').value = price;
            document.getElementById('productStock').value = stock;
            document.getElementById('updateProductBtn').style.display = 'block';
        }

        function deleteProduct(id) {
            if (confirm('Are you sure you want to delete this product?')) {
                fetch(`http://localhost:3000/deleteProduct/${id}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    loadProducts();
                })
                .catch((error) => {
                    console.error('Error deleting product:', error);
                });
            }
        }

        function resetProductForm() {
            document.getElementById('productId').value = '';
            document.getElementById('productName').value = '';
            document.getElementById('productDescription').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productStock').value = '';
            document.getElementById('updateProductBtn').style.display = 'none';
        }

        // Load Users
        function loadUsers() {
            fetch('http://localhost:3000/users')
                .then(response => response.json())
                .then(data => {
                    const userTableBody = document.getElementById('userTableBody');
                    userTableBody.innerHTML = '';
                    data.forEach(user => {
                        const row = `<tr>
                            <td>${user.id}</td>
                            <td>${user.first_name} ${user.last_name}</td>
                            <td>${user.email}</td>
                            <td>${user.contact_number}</td>
                            <td>${user.address}</td>
                            <td>${user.is_admin ? 'Yes' : 'No'}</td>
                            <td>
                                <button onclick="editUser(${user.id}, '${user.first_name}', '${user.last_name}', '${user.email}', '${user.contact_number}', '${user.address}', ${user.is_admin})" class="btn btn-warning">Edit</button>
                                <button onclick="deleteUser(${user.id})" class="btn btn-danger">Delete</button>
                            </td>
                        </tr>`;
                        userTableBody.innerHTML += row;
                    });
                })
                .catch((error) => {
                    console.error('Error fetching users:', error);
                });
        }

        // Add or Update User
        document.getElementById('userForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const id = document.getElementById('userId').value;
            const first_name = document.getElementById('userFirstName').value;
            const last_name = document.getElementById('userLastName').value;
            const email = document.getElementById('userEmail').value;
            const contact_number = document.getElementById('userContact').value;
            const address = document.getElementById('userAddress').value;
            const is_admin = document.getElementById('isAdmin').value;

            if (id) {
                fetch(`http://localhost:3000/updateUser/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ first_name, last_name, email, contact_number, address, is_admin })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    resetUserForm();
                    loadUsers();
                })
                .catch((error) => {
                    console.error('Error updating user:', error);
                });
            } else {
                fetch('http://localhost:3000/addUser', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ first_name, last_name, email, contact_number, address, is_admin })
                })
                .then(response => response.json())
                .then(data => {
                    alert('User added successfully!');
                    resetUserForm();
                    loadUsers();
                })
                .catch((error) => {
                    console.error('Error adding user:', error);
                });
            }
        });

        function editUser(id, first_name, last_name, email, contact_number, address, is_admin) {
            document.getElementById('userId').value = id;
            document.getElementById('userFirstName').value = first_name;
            document.getElementById('userLastName').value = last_name;
            document.getElementById('userEmail').value = email;
            document.getElementById('userContact').value = contact_number;
            document.getElementById('userAddress').value = address;
            document.getElementById('isAdmin').value = is_admin;
            document.getElementById('updateUserBtn').style.display = 'block';
        }

        function deleteUser(id) {
            if (confirm('Are you sure you want to delete this user?')) {
                fetch(`http://localhost:3000/deleteUser/${id}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    loadUsers();
                })
                .catch((error) => {
                    console.error('Error deleting user:', error);
                });
            }
        }

        function resetUserForm() {
            document.getElementById('userId').value = '';
            document.getElementById('userFirstName').value = '';
            document.getElementById('userLastName').value = '';
            document.getElementById('userEmail').value = '';
            document.getElementById('userContact').value = '';
            document.getElementById('userAddress').value = '';
            document.getElementById('isAdmin').value = '0';
            document.getElementById('updateUserBtn').style.display = 'none';
        }

        // Load Order History
        function loadOrderHistory() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            fetch(`http://localhost:3000/orders?startDate=${startDate}&endDate=${endDate}`)
                .then(response => response.json())
                .then(data => {
                    const orderHistoryBody = document.getElementById('orderHistory');
                    orderHistoryBody.innerHTML = '';
                    data.forEach(order => {
                        const row = `<tr>
                            <td>${order.order_id}</td>
                            <td>${order.first_name} ${order.last_name}</td>
                            <td>${order.quantity}</td>
                            <td>${order.total_price}</td>
                            <td>${order.created_at}</td>
                        </tr>`;
                        orderHistoryBody.innerHTML += row;
                    });
                })
                .catch((error) => {
                    console.error('Error fetching order history:', error);
                });
        }

        // Initial Load
        loadProducts();
        loadUsers();
    </script>
</body>
</html>
